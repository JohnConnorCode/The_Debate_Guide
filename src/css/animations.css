/* ==========================================
   ANIMATION SYSTEM - Progressive Enhancement

   CRITICAL: Content is VISIBLE by default.
   Animations only apply when:
   1. JS has loaded and is ready (.js-ready on html)
   2. User hasn't requested reduced motion
   ========================================== */

/* ==========================================
   KEYFRAMES
   ========================================== */

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(16px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes scaleIn {
    from {
        opacity: 0;
        transform: scale(0.95);
    }
    to {
        opacity: 1;
        transform: scale(1);
    }
}

@keyframes expandWidth {
    from { width: 0; }
    to { width: 100%; }
}

@keyframes rotate {
    to { transform: rotate(360deg); }
}

/* ==========================================
   DEFAULT STATE: EVERYTHING VISIBLE
   Content shows immediately - no flash of invisible content
   ========================================== */

.hero-animate,
[data-animate] {
    opacity: 1;
    transform: none;
}

/* ==========================================
   ANIMATION STATES: Enable animations on ALL devices
   Only hide content when JS is ready to animate
   ========================================== */

/* When JS signals it's ready, THEN hide elements for animation */
.js-ready .hero-animate:not(.is-visible),
.js-ready [data-animate]:not(.is-visible) {
    opacity: 0;
    transform: translateY(16px);
}

.js-ready [data-animate="fade"]:not(.is-visible) {
    transform: none;
}

.js-ready [data-animate="scale"]:not(.is-visible) {
    transform: scale(0.95);
}

/* Animate in when visible */
/* fill-mode: both = backwards (apply initial during delay) + forwards (keep final after) */
.js-ready .hero-animate.is-visible,
.js-ready [data-animate].is-visible {
    animation: fadeInUp 0.5s ease-out both;
}

.js-ready [data-animate="fade"].is-visible {
    animation-name: fadeIn;
}

.js-ready [data-animate="scale"].is-visible {
    animation-name: scaleIn;
}

/* Hero stagger delays */
.js-ready .hero-animate-1.is-visible { animation-delay: 0ms; }
.js-ready .hero-animate-2.is-visible { animation-delay: 100ms; }
.js-ready .hero-animate-3.is-visible { animation-delay: 200ms; }
.js-ready .hero-animate-4.is-visible { animation-delay: 300ms; }
.js-ready .hero-animate-5.is-visible { animation-delay: 400ms; }

/* Chapter hero stagger */
.js-ready .chapter-hero > [data-animate]:nth-child(2).is-visible { animation-delay: 0ms; }
.js-ready .chapter-hero > [data-animate]:nth-child(3).is-visible { animation-delay: 100ms; }
.js-ready .chapter-hero > [data-animate]:nth-child(4).is-visible { animation-delay: 200ms; }
.js-ready .chapter-hero > [data-animate]:nth-child(5).is-visible { animation-delay: 300ms; }
.js-ready .chapter-hero > [data-animate]:nth-child(6).is-visible { animation-delay: 400ms; }

/* TOC hero stagger */
.js-ready .toc-hero .hero-animate-1.is-visible { animation-delay: 0ms; }
.js-ready .toc-hero .hero-animate-2.is-visible { animation-delay: 100ms; }
.js-ready .toc-hero .hero-animate-3.is-visible { animation-delay: 200ms; }
.js-ready .toc-hero .hero-animate-4.is-visible { animation-delay: 300ms; }

/* TOC chapter list stagger */
.js-ready .toc-chapters [data-animate]:nth-child(1).is-visible { animation-delay: 0ms; }
.js-ready .toc-chapters [data-animate]:nth-child(2).is-visible { animation-delay: 50ms; }
.js-ready .toc-chapters [data-animate]:nth-child(3).is-visible { animation-delay: 100ms; }
.js-ready .toc-chapters [data-animate]:nth-child(4).is-visible { animation-delay: 150ms; }
.js-ready .toc-chapters [data-animate]:nth-child(5).is-visible { animation-delay: 200ms; }
.js-ready .toc-chapters [data-animate]:nth-child(n+6).is-visible { animation-delay: 250ms; }

/* ==========================================
   SUNBURST - decorative rotation (all devices)
   ========================================== */

/* Desktop */
@media (min-width: 769px) {
    .sunburst-hero svg {
        animation: rotate 600s linear infinite;
    }

    .chapter-hero .sunburst svg {
        animation: rotate 360s linear infinite;
    }
}

/* Tablet */
@media (max-width: 768px) {
    .sunburst-hero {
        width: 700px;
        height: 700px;
        opacity: 0.15;
    }

    .sunburst-hero svg,
    .chapter-hero .sunburst svg {
        animation: rotate 300s linear infinite;
    }
}

/* Mobile */
@media (max-width: 600px) {
    .sunburst-hero {
        width: 550px;
        height: 550px;
        opacity: 0.12;
    }

    .sunburst-hero svg,
    .chapter-hero .sunburst svg {
        animation: rotate 240s linear infinite;
    }
}

/* Small mobile */
@media (max-width: 480px) {
    .sunburst-hero {
        width: 450px;
        height: 450px;
        opacity: 0.1;
    }
}

/* ==========================================
   TEXT SELECTION STYLING
   ========================================== */

::selection {
    background: rgba(201, 162, 39, 0.3);
    color: var(--text-primary);
}

::-moz-selection {
    background: rgba(201, 162, 39, 0.3);
    color: var(--text-primary);
}

/* ==========================================
   HOVER EFFECTS (desktop only)
   ========================================== */

@media (min-width: 769px) {
    .hover-lift {
        transition: transform 0.25s ease-out, box-shadow 0.25s ease-out;
    }

    .hover-lift:hover {
        transform: translateY(-4px);
        box-shadow: var(--shadow-elevation-3, 0 10px 15px -3px rgba(0, 0, 0, 0.1));
    }

    .hover-glow {
        transition: box-shadow 0.25s ease-out, border-color 0.25s ease-out;
    }

    .hover-glow:hover {
        box-shadow: var(--shadow-gold-glow, 0 0 30px rgba(201, 162, 39, 0.25));
    }

    .interactive-gold {
        transition: transform 0.25s ease-out, box-shadow 0.25s ease-out, border-color 0.25s ease-out;
    }

    .interactive-gold:hover {
        transform: translateY(-4px);
        box-shadow: var(--shadow-elevation-3, 0 10px 15px -3px rgba(0, 0, 0, 0.1));
        border-color: var(--color-gold-border, rgba(201, 162, 39, 0.3));
    }

    .interactive-gold:active {
        transform: translateY(-2px) scale(0.98);
        transition-duration: 0.1s;
    }
}

.hover-underline {
    position: relative;
}

.hover-underline::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 0;
    height: 1px;
    background: var(--color-gold);
    transition: width 0.25s ease-out;
}

.hover-underline:hover::after {
    width: 100%;
}

/* ==========================================
   LOADING STATES
   ========================================== */

@keyframes shimmer {
    from { background-position: -200% 0; }
    to { background-position: 200% 0; }
}

.loading {
    position: relative;
    overflow: hidden;
}

.loading::after {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(
        90deg,
        transparent,
        rgba(var(--color-white-rgb), 0.1),
        transparent
    );
    animation: shimmer 2s infinite;
}

/* ==========================================
   PAGE TRANSITIONS
   ========================================== */

@keyframes pageEnter {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes pageExit {
    from { opacity: 1; }
    to { opacity: 0; }
}

.page-transition-enter {
    animation: pageEnter 0.25s ease-out forwards;
}

.page-transition-exit {
    animation: pageExit 0.2s ease-in forwards;
    pointer-events: none;
}

@view-transition {
    navigation: auto;
}

::view-transition-old(root) {
    animation: pageExit 0.2s ease-in;
}

::view-transition-new(root) {
    animation: pageEnter 0.25s ease-out;
}

/* ==========================================
   REDUCED MOTION - respect user preference
   ========================================== */

@media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
    }

    .hero-animate,
    [data-animate] {
        opacity: 1 !important;
        transform: none !important;
    }

    .sunburst-hero svg,
    .chapter-hero .sunburst svg {
        animation: none !important;
    }
}

/* ==========================================
   NO-JS FALLBACK
   ========================================== */

.no-js .hero-animate,
.no-js [data-animate] {
    opacity: 1;
    transform: none;
}

/* ==========================================
   PRINT
   ========================================== */

@media print {
    * {
        animation: none !important;
        transition: none !important;
    }

    .hero-animate,
    [data-animate] {
        opacity: 1 !important;
        transform: none !important;
    }
}
