/* ==========================================
   ANIMATION SYSTEM - Progressive Enhancement

   CRITICAL: Content is VISIBLE by default.
   Animations only apply when:
   1. JS has loaded and is ready (.js-ready on html)
   2. User hasn't requested reduced motion
   ========================================== */

/* ==========================================
   KEYFRAMES
   ========================================== */

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(16px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes scaleIn {
    from {
        opacity: 0;
        transform: scale(0.95);
    }
    to {
        opacity: 1;
        transform: scale(1);
    }
}

@keyframes expandWidth {
    from { width: 0; }
    to { width: 100%; }
}

@keyframes rotate {
    to { transform: rotate(360deg); }
}

/* ==========================================
   HERO ANIMATIONS - Shared keyframes (DRY)
   Used by: TOC hero, Chapter hero, any future heroes
   ========================================== */

/* Title reveal - dramatic clip-path from center */
@keyframes heroTitleReveal {
    0% {
        clip-path: inset(0 50% 0 50%);
        opacity: 1;
    }
    100% {
        clip-path: inset(0 0 0 0);
        opacity: 1;
    }
}

/* Number reveal - scale up with fade */
@keyframes heroNumberReveal {
    0% {
        opacity: 0;
        transform: scale(0.8);
    }
    100% {
        opacity: 1;
        transform: scale(1);
    }
}

/* Tagline/part title - letter spacing contracts */
@keyframes heroTaglineReveal {
    0% {
        opacity: 0;
        letter-spacing: 0.4em;
        transform: scaleX(0.9);
    }
    100% {
        opacity: 1;
        letter-spacing: var(--hero-tagline-spacing, 0.15em);
        transform: scaleX(1);
    }
}

/* Subtitle - smooth fade up */
@keyframes heroSubtitleReveal {
    0% {
        opacity: 0;
        transform: translateY(20px);
    }
    100% {
        opacity: var(--hero-subtitle-opacity, 0.9);
        transform: translateY(0);
    }
}

/* Meta info - simple fade */
@keyframes heroMetaReveal {
    0% { opacity: 0; }
    100% { opacity: var(--hero-meta-opacity, 0.7); }
}

/* CTA - bounce entrance */
@keyframes heroCTAReveal {
    0% {
        opacity: 0;
        transform: translateY(16px) scale(0.95);
    }
    60% {
        opacity: 1;
        transform: translateY(-4px) scale(1.02);
    }
    100% {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

/* Decoration fade in (for centered elements) */
@keyframes heroDecorationReveal {
    0% {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.95);
    }
    100% {
        opacity: var(--target-opacity, 0.15);
        transform: translate(-50%, -50%) scale(1);
    }
}

/* Stroke draw animation */
@keyframes heroStrokeDraw {
    0% {
        opacity: 0;
        stroke-dashoffset: 200;
    }
    50% {
        opacity: 0.25;
    }
    100% {
        opacity: 0.25;
        stroke-dashoffset: 0;
    }
}

/* ==========================================
   DEFAULT STATE: EVERYTHING VISIBLE
   Content shows immediately - no flash of invisible content
   ========================================== */

.hero-animate,
[data-animate] {
    opacity: 1;
    transform: none;
}

/* Hero TEXT content should never animate - show immediately to prevent flash */
.toc-hero .hero-animate,
.chapter-hero [data-animate] {
    opacity: 1 !important;
    transform: none !important;
    clip-path: none !important;
    letter-spacing: inherit !important;
    animation: none !important;
}

/* Hero decorations can stay visible (no flash), allow rotation animation */
.hero-decoration,
.hero-rays,
.hero-greek-key,
.hero-bottom-accent {
    opacity: 1;
}

/* ==========================================
   ANIMATION STATES: Enable animations on ALL devices
   Only hide content when JS is ready to animate
   ========================================== */

/* When JS signals it's ready, THEN hide elements for animation */
.js-ready .hero-animate:not(.is-visible),
.js-ready [data-animate]:not(.is-visible) {
    opacity: 0;
    transform: translateY(16px);
}

.js-ready [data-animate="fade"]:not(.is-visible) {
    transform: none;
}

.js-ready [data-animate="scale"]:not(.is-visible) {
    transform: scale(0.95);
}

/* TOC Hero - Custom initial states for dramatic reveals */
.js-ready .toc-hero .hero-animate-1:not(.is-visible) {
    /* Title: hidden via clip-path, not opacity (cleaner reveal) */
    opacity: 1;
    transform: none;
    clip-path: inset(0 50% 0 50%);
}

.js-ready .toc-hero .hero-animate-2:not(.is-visible) {
    /* Tagline: expanded letter-spacing, scaled down */
    opacity: 0;
    transform: scaleX(0.9);
    letter-spacing: 0.4em;
}

.js-ready .toc-hero .hero-animate-3:not(.is-visible) {
    /* Subtitle: standard fade up */
    opacity: 0;
    transform: translateY(20px);
}

.js-ready .toc-hero .hero-animate-4:not(.is-visible) {
    /* CTA: hidden, will pop in */
    opacity: 0;
    transform: translateY(16px) scale(0.95);
}

/* Hero decoration initial states */
.js-ready .toc-hero .hero-decoration {
    opacity: 0;
}

.js-ready .toc-hero .hero-rays {
    opacity: 0;
    transform: translate(-50%, -50%) scale(0.95);
}

.js-ready .toc-hero .hero-greek-key {
    opacity: 0;
    transform: translate(-50%, -50%) scale(0.95);
}

.js-ready .toc-hero .hero-bottom-accent {
    opacity: 0;
}

/* Animate in when visible */
/* fill-mode: both = backwards (apply initial during delay) + forwards (keep final after) */
.js-ready .hero-animate.is-visible,
.js-ready [data-animate].is-visible {
    animation: fadeInUp 0.5s ease-out both;
}

.js-ready [data-animate="fade"].is-visible {
    animation-name: fadeIn;
}

.js-ready [data-animate="scale"].is-visible {
    animation-name: scaleIn;
}

/* Hero stagger delays */
.js-ready .hero-animate-1.is-visible { animation-delay: 0ms; }
.js-ready .hero-animate-2.is-visible { animation-delay: 100ms; }
.js-ready .hero-animate-3.is-visible { animation-delay: 200ms; }
.js-ready .hero-animate-4.is-visible { animation-delay: 300ms; }
.js-ready .hero-animate-5.is-visible { animation-delay: 400ms; }

/* Chapter hero stagger */
.js-ready .chapter-hero > [data-animate]:nth-child(2).is-visible { animation-delay: 0ms; }
.js-ready .chapter-hero > [data-animate]:nth-child(3).is-visible { animation-delay: 100ms; }
.js-ready .chapter-hero > [data-animate]:nth-child(4).is-visible { animation-delay: 200ms; }
.js-ready .chapter-hero > [data-animate]:nth-child(5).is-visible { animation-delay: 300ms; }
.js-ready .chapter-hero > [data-animate]:nth-child(6).is-visible { animation-delay: 400ms; }

/* ==========================================
   TOC HERO ANIMATION SYSTEM

   Timing controlled by CSS custom properties
   ========================================== */

/* Shared easing */
:root {
    --hero-ease: cubic-bezier(0.22, 1, 0.36, 1);
    --hero-ease-bounce: cubic-bezier(0.34, 1.56, 0.64, 1);
}

/* Default timing (desktop) */
.toc-hero {
    --hero-delay-1: 150ms;  /* Title */
    --hero-delay-2: 450ms;  /* Tagline */
    --hero-delay-3: 650ms;  /* Subtitle */
    --hero-delay-5: 1000ms; /* CTA */
    --hero-delay-6: 1200ms; /* Flourish */
}

/* ==========================================
   TOC HERO - Specific overrides
   ========================================== */

/* Legacy class support (hero-animate-*) */
.js-ready .toc-hero .hero-animate-1.is-visible {
    animation: heroTitleReveal 0.5s var(--hero-ease) var(--hero-delay-1) both;
}

.js-ready .toc-hero .hero-animate-1:not(.is-visible) {
    opacity: 1;
    clip-path: inset(0 50% 0 50%);
}

.js-ready .toc-hero .hero-animate-2.is-visible {
    animation: heroTaglineReveal 0.4s var(--hero-ease) var(--hero-delay-2) both;
}

.js-ready .toc-hero .hero-animate-2:not(.is-visible) {
    opacity: 0;
    letter-spacing: 0.4em;
    transform: scaleX(0.9);
}

.js-ready .toc-hero .hero-animate-3.is-visible {
    animation: heroSubtitleReveal 0.45s var(--hero-ease) var(--hero-delay-3) both;
}

.js-ready .toc-hero .hero-animate-3:not(.is-visible) {
    opacity: 0;
    transform: translateY(20px);
}

.js-ready .toc-hero .hero-animate-4.is-visible {
    animation: heroCTAReveal 0.4s var(--hero-ease-bounce) var(--hero-delay-5) both;
}

.js-ready .toc-hero .hero-animate-4:not(.is-visible) {
    opacity: 0;
    transform: translateY(16px) scale(0.95);
}

/* TOC Hero decoration */
.js-ready .toc-hero .hero-decoration {
    animation: fadeIn 0.6s ease-out both;
}

.js-ready .toc-hero .hero-rays {
    --target-opacity: 0.15;
    animation:
        heroDecorationReveal 0.8s ease-out both,
        hero-rays-rotate 120s linear 1s infinite;
}

.js-ready .toc-hero .hero-greek-key {
    --target-opacity: 0.06;
    animation: heroDecorationReveal 1s ease-out 0.1s both;
}

.js-ready .toc-hero .hero-bottom-accent {
    animation: fadeIn 0.5s ease-out var(--hero-delay-6) both;
}

/* ==========================================
   CHAPTER HERO - Keep existing data-animate system
   Chapter heroes use the standard fadeInUp animation
   ========================================== */

/* Chapter hero stagger timing */
.js-ready .chapter-hero > [data-animate]:nth-child(2).is-visible { animation-delay: 0ms; }
.js-ready .chapter-hero > [data-animate]:nth-child(3).is-visible { animation-delay: 100ms; }
.js-ready .chapter-hero > [data-animate]:nth-child(4).is-visible { animation-delay: 200ms; }
.js-ready .chapter-hero > [data-animate]:nth-child(5).is-visible { animation-delay: 300ms; }
.js-ready .chapter-hero > [data-animate]:nth-child(6).is-visible { animation-delay: 400ms; }

/* ==========================================
   RESPONSIVE - Faster on mobile
   ========================================== */

@media (max-width: 768px) {
    .toc-hero {
        --hero-delay-1: 100ms;
        --hero-delay-2: 350ms;
        --hero-delay-3: 550ms;
        --hero-delay-4: 700ms;
        --hero-delay-5: 850ms;
        --hero-delay-6: 1000ms;
    }

    .js-ready .toc-hero .hero-rays {
        --target-opacity: 0.12;
    }

    .js-ready .toc-hero .hero-greek-key {
        --target-opacity: 0.04;
    }
}

@media (max-width: 600px) {
    .toc-hero {
        --hero-delay-1: 50ms;
        --hero-delay-2: 250ms;
        --hero-delay-3: 400ms;
        --hero-delay-4: 550ms;
        --hero-delay-5: 700ms;
        --hero-delay-6: 850ms;
    }

    .js-ready .toc-hero .hero-rays {
        --target-opacity: 0.1;
    }
}

/* TOC chapter list stagger */
.js-ready .toc-chapters [data-animate]:nth-child(1).is-visible { animation-delay: 0ms; }
.js-ready .toc-chapters [data-animate]:nth-child(2).is-visible { animation-delay: 50ms; }
.js-ready .toc-chapters [data-animate]:nth-child(3).is-visible { animation-delay: 100ms; }
.js-ready .toc-chapters [data-animate]:nth-child(4).is-visible { animation-delay: 150ms; }
.js-ready .toc-chapters [data-animate]:nth-child(5).is-visible { animation-delay: 200ms; }
.js-ready .toc-chapters [data-animate]:nth-child(n+6).is-visible { animation-delay: 250ms; }

/* ==========================================
   CHAPTER SUNBURST - decorative rotation
   Note: Home hero uses hero-decoration (in home.njk)
   ========================================== */

/* Desktop */
@media (min-width: 769px) {
    .chapter-hero .sunburst svg {
        animation: rotate 360s linear infinite;
    }
}

/* Tablet & Mobile */
@media (max-width: 768px) {
    .chapter-hero .sunburst svg {
        animation: rotate 300s linear infinite;
    }
}

@media (max-width: 600px) {
    .chapter-hero .sunburst svg {
        animation: rotate 240s linear infinite;
    }
}

/* ==========================================
   TEXT SELECTION STYLING
   ========================================== */

::selection {
    background: rgba(201, 162, 39, 0.3);
    color: var(--text-primary);
}

::-moz-selection {
    background: rgba(201, 162, 39, 0.3);
    color: var(--text-primary);
}

/* ==========================================
   HOVER EFFECTS (desktop only)
   ========================================== */

@media (min-width: 769px) {
    .hover-lift {
        transition: transform 0.25s ease-out, box-shadow 0.25s ease-out;
    }

    .hover-lift:hover {
        transform: translateY(-4px);
        box-shadow: var(--shadow-elevation-3, 0 10px 15px -3px rgba(0, 0, 0, 0.1));
    }

    .hover-glow {
        transition: box-shadow 0.25s ease-out, border-color 0.25s ease-out;
    }

    .hover-glow:hover {
        box-shadow: var(--shadow-gold-glow, 0 0 30px rgba(201, 162, 39, 0.25));
    }

    .interactive-gold {
        transition: transform 0.25s ease-out, box-shadow 0.25s ease-out, border-color 0.25s ease-out;
    }

    .interactive-gold:hover {
        transform: translateY(-4px);
        box-shadow: var(--shadow-elevation-3, 0 10px 15px -3px rgba(0, 0, 0, 0.1));
        border-color: var(--color-gold-border, rgba(201, 162, 39, 0.3));
    }

    .interactive-gold:active {
        transform: translateY(-2px) scale(0.98);
        transition-duration: 0.1s;
    }
}

.hover-underline {
    position: relative;
}

.hover-underline::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 0;
    height: 1px;
    background: var(--color-gold);
    transition: width 0.25s ease-out;
}

.hover-underline:hover::after {
    width: 100%;
}

/* ==========================================
   LOADING STATES
   ========================================== */

@keyframes shimmer {
    from { background-position: -200% 0; }
    to { background-position: 200% 0; }
}

.loading {
    position: relative;
    overflow: hidden;
}

.loading::after {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(
        90deg,
        transparent,
        rgba(var(--color-white-rgb), 0.1),
        transparent
    );
    animation: shimmer 2s infinite;
}

/* ==========================================
   PAGE TRANSITIONS - View Transition API

   Uses crossfade (150ms) instead of sequential fade (450ms)
   for perceived-instant navigation. Gracefully degrades
   to instant navigation in unsupported browsers.
   ========================================== */

@view-transition {
    navigation: auto;
}

/* Crossfade: both animations run simultaneously */
::view-transition-old(root),
::view-transition-new(root) {
    animation-duration: 150ms;
    animation-timing-function: ease-out;
    mix-blend-mode: normal;
}

::view-transition-old(root) {
    animation-name: vt-fade-out;
}

::view-transition-new(root) {
    animation-name: vt-fade-in;
}

@keyframes vt-fade-out {
    to { opacity: 0; }
}

@keyframes vt-fade-in {
    from { opacity: 0; }
}

/* ==========================================
   REDUCED MOTION - respect user preference
   ========================================== */

@media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
    }

    /* All animated elements - show at final state */
    .hero-animate,
    [data-animate] {
        opacity: 1 !important;
        transform: none !important;
        clip-path: none !important;
        letter-spacing: inherit !important;
    }

    /* Disable rotating elements */
    .hero-rays,
    .sunburst svg {
        animation: none !important;
    }

    /* TOC hero decorations - show at final state */
    .toc-hero .hero-decoration,
    .toc-hero .hero-rays,
    .toc-hero .hero-greek-key,
    .toc-hero .hero-bottom-accent {
        opacity: 1 !important;
        transform: none !important;
    }

    .toc-hero .hero-rays {
        opacity: 0.15 !important;
    }

    .toc-hero .hero-greek-key {
        opacity: 0.06 !important;
    }
}

/* ==========================================
   NO-JS FALLBACK
   ========================================== */

.no-js .hero-animate,
.no-js [data-animate] {
    opacity: 1;
    transform: none;
    clip-path: none;
}

/* No-JS: TOC hero decorations at final state */
.no-js .toc-hero .hero-decoration,
.no-js .toc-hero .hero-rays,
.no-js .toc-hero .hero-greek-key,
.no-js .toc-hero .hero-bottom-accent {
    opacity: 1;
}

.no-js .toc-hero .hero-rays {
    opacity: 0.15;
}

.no-js .toc-hero .hero-greek-key {
    opacity: 0.06;
}

/* ==========================================
   PRINT
   ========================================== */

@media print {
    * {
        animation: none !important;
        transition: none !important;
    }

    .hero-animate,
    [data-animate] {
        opacity: 1 !important;
        transform: none !important;
    }
}
