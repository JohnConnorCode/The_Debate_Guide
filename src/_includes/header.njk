{# Header component - configurable nav based on page type #}
<header class="header" role="banner">
    <div class="header-inner">
        <a href="{{ '/' | url }}" class="logo"{% if pageType == "home" %} aria-current="page"{% endif %} aria-label="The Debate Guide - Home">
            <div class="logo-mark" aria-hidden="true">
                <svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg" class="logo-svg">
                    <!-- Laurel wreath - symbol of victory -->
                    <!-- Left branch -->
                    <path d="M24 8 Q14 14 12 24 Q14 34 24 40" stroke="currentColor" stroke-width="2" fill="none" class="logo-laurel"/>
                    <!-- Right branch -->
                    <path d="M24 8 Q34 14 36 24 Q34 34 24 40" stroke="currentColor" stroke-width="2" fill="none" class="logo-laurel"/>
                    <!-- Left leaves -->
                    <path d="M16 13 Q19 16 16 20" stroke="currentColor" stroke-width="1.5" fill="none" opacity="0.7"/>
                    <path d="M14 21 Q17 24 14 28" stroke="currentColor" stroke-width="1.5" fill="none" opacity="0.7"/>
                    <path d="M15 30 Q18 33 16 36" stroke="currentColor" stroke-width="1.5" fill="none" opacity="0.7"/>
                    <!-- Right leaves -->
                    <path d="M32 13 Q29 16 32 20" stroke="currentColor" stroke-width="1.5" fill="none" opacity="0.7"/>
                    <path d="M34 21 Q31 24 34 28" stroke="currentColor" stroke-width="1.5" fill="none" opacity="0.7"/>
                    <path d="M33 30 Q30 33 32 36" stroke="currentColor" stroke-width="1.5" fill="none" opacity="0.7"/>
                    <!-- Delta (Î”) - Greek letter, change/discourse -->
                    <path d="M24 16 L30 32 L18 32 Z" stroke="currentColor" stroke-width="2.5" fill="none" stroke-linejoin="round" class="logo-delta"/>
                </svg>
            </div>
            <span class="logo-text">THE DEBATE GUIDE</span>
        </a>

        {# Reading position indicator - shown on chapter pages #}
        {% if pageType == "chapter" and chapterNumber %}
        <div class="reading-position" aria-live="polite" aria-label="Reading progress">
            <span class="reading-position-text">Chapter <span class="reading-position-current">{{ chapterNumber }}</span> of 20</span>
        </div>
        {% endif %}

        {# Desktop navigation #}
        <nav class="nav nav-desktop" aria-label="Main navigation">
            {% if pageType == "home" %}
                <a href="{{ '/introduction/' | url }}">Introduction</a>
                <a href="#contents" aria-current="true">Contents</a>
                <a href="{{ '/quizzes/' | url }}">Quizzes</a>
                <a href="{{ '/progress/' | url }}" class="nav-progress-link">
                    <span>Progress</span>
                    <span class="nav-progress-badge" id="nav-progress-badge" style="display: none;">0/20</span>
                </a>
                <a href="{{ '/about/' | url }}">About</a>
            {% elif pageType == "introduction" %}
                <a href="{{ '/' | url }}">Contents</a>
                <a href="#part-1">Start</a>
                <a href="{{ '/quizzes/' | url }}">Quizzes</a>
                <a href="{{ '/progress/' | url }}" class="nav-progress-link">
                    <span>Progress</span>
                    <span class="nav-progress-badge" id="nav-progress-badge" style="display: none;">0/20</span>
                </a>
                <a href="{{ '/about/' | url }}">About</a>
            {% else %}
                <a href="{{ '/' | url }}">Contents</a>
                <a href="{{ '/introduction/' | url }}">Introduction</a>
                <a href="{{ '/quizzes/' | url }}">Quizzes</a>
                <a href="{{ '/progress/' | url }}" class="nav-progress-link">
                    <span>Progress</span>
                    <span class="nav-progress-badge" id="nav-progress-badge" style="display: none;">0/20</span>
                </a>
                <a href="{{ '/about/' | url }}">About</a>
            {% endif %}
            <button class="search-trigger" id="search-trigger" aria-label="Search (Press / or Ctrl+K)" title="Search">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                </svg>
                <kbd class="search-shortcut-hint">/</kbd>
            </button>
            {# Auth button - shown when Supabase is configured #}
            <button class="auth-login-btn" id="auth-login-btn" title="Sign in to sync progress">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                </svg>
                <span>Sign In</span>
            </button>
            <div class="auth-user-menu" id="auth-user-menu">
                <img class="auth-user-avatar" id="auth-user-avatar" alt="" />
                <span class="auth-user-name" id="auth-user-name"></span>
                <button class="auth-logout-btn" id="auth-logout-btn">Log out</button>
            </div>
            <a href="https://superdebate.org" target="_blank" rel="noopener noreferrer" class="nav-cta">Join SuperDebate</a>
        </nav>

        {# Mobile hamburger button #}
        <button class="mobile-menu-btn" aria-label="Open navigation menu" aria-expanded="false" aria-controls="mobile-nav">
            <span class="hamburger-line" aria-hidden="true"></span>
            <span class="hamburger-line" aria-hidden="true"></span>
            <span class="hamburger-line" aria-hidden="true"></span>
        </button>
    </div>
    <div class="header-line"></div>
</header>

{# Mobile navigation drawer #}
<div class="mobile-nav-overlay" aria-hidden="true"></div>
<nav class="mobile-nav" id="mobile-nav" aria-label="Mobile navigation" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="mobile-nav-header">
        <span class="mobile-nav-title" id="mobile-nav-title">Navigate</span>
        <button class="mobile-nav-close" aria-label="Close navigation menu">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </button>
    </div>
    <button class="mobile-nav-search" id="mobile-search-trigger" aria-label="Search">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"></circle>
            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
        </svg>
        <span>Search chapters...</span>
    </button>
    <div class="mobile-nav-links">
        <a href="{{ '/' | url }}" class="mobile-nav-link">Contents</a>
        <a href="{{ '/introduction/' | url }}" class="mobile-nav-link">Introduction</a>
        <a href="{{ '/quizzes/' | url }}" class="mobile-nav-link">All Quizzes</a>
        <a href="{{ '/progress/' | url }}" class="mobile-nav-link mobile-progress-link">
            <span>Your Progress</span>
            <span class="mobile-progress-badge" id="mobile-progress-badge" style="display: none;">0/20</span>
        </a>

        {% for part in chapters.parts %}
        <div class="mobile-nav-section">
            <button class="mobile-nav-section-toggle" aria-expanded="false">
                <span class="mobile-nav-section-number">{{ part.number }}</span>
                <span class="mobile-nav-section-title">{{ part.title }}</span>
                <svg class="mobile-nav-chevron" width="16" height="16" viewBox="0 0 16 16" aria-hidden="true">
                    <path d="M4 6l4 4 4-4" stroke="currentColor" stroke-width="2" fill="none"/>
                </svg>
            </button>
            <div class="mobile-nav-chapters" aria-hidden="true">
                {% for chapter in part.chapters %}
                <a href="{{ '/chapters/' + part.id + '/chapter-' + (chapter.number | padZero) + '-' + chapter.slug + '/' | url }}" class="mobile-nav-chapter">
                    <span class="mobile-nav-chapter-num">{{ chapter.number | padZero }}</span>
                    <span class="mobile-nav-chapter-title">{{ chapter.title }}</span>
                </a>
                {% endfor %}
            </div>
        </div>
        {% endfor %}

        <a href="{{ '/about/' | url }}" class="mobile-nav-link">About</a>
        <a href="{{ '/author/' | url }}" class="mobile-nav-link">Author</a>

        {# Mobile auth button #}
        <button class="mobile-nav-auth" id="mobile-auth-btn">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
            </svg>
            <span id="mobile-auth-text">Sign In</span>
        </button>
    </div>
    <div class="mobile-nav-cta">
        <a href="https://superdebate.org" target="_blank" rel="noopener noreferrer" class="btn-primary">Join SuperDebate</a>
    </div>
</nav>

{# Progress badge updater script #}
<script>
(function() {
    'use strict';
    try {
        var progress = localStorage.getItem('debateGuideQuizProgress');
        if (!progress) return;

        var data;
        try {
            data = JSON.parse(progress);
        } catch (parseErr) {
            console.debug('Invalid quiz progress data in localStorage');
            return;
        }

        var passedCount = Object.values(data).filter(function(p) {
            return p && p.percentage >= 70;
        }).length;

        if (passedCount > 0) {
            var badges = document.querySelectorAll('#nav-progress-badge, #mobile-progress-badge');
            badges.forEach(function(badge) {
                badge.textContent = passedCount + '/20';
                badge.style.display = 'inline-flex';
            });
        }
    } catch (e) {
        console.debug('Error updating progress badge:', e);
    }
})();
</script>
